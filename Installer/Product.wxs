<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="CompactApp" Language="1033" Version="$(var.ProductVersion)" Manufacturer="YourCompany" UpgradeCode="a1111111-2222-3333-4444-555555555555">
    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" Description="CompactApp installer"/>

    <MediaTemplate />

    <!-- Use MajorUpgrade to handle normal upgrades and allow downgrades if desired -->
    <MajorUpgrade AllowDowngrades="yes" DowngradeErrorMessage="A newer version of CompactApp is already installed." />

    <!-- Define common directories -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="CompactApp" />
      </Directory>

      <!-- Special folders for shortcuts -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="CompactApp" />
      </Directory>
      <Directory Id="DesktopFolder" />
    </Directory>

    <DirectoryRef Id="INSTALLFOLDER">
      <!-- Main executable component. Guid="*" lets WiX generate a stable GUID at build time -->
      <Component Id="cmpMainExe" Guid="*">
        <File Id="filMainExe" Source="$(var.CompactAppWinForms.TargetPath)" KeyPath="yes">
          <!-- Shortcut in Start Menu (created as child of the File element) -->
          <Shortcut Id="startMenuShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="CompactApp"
                    Description="Launch CompactApp"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="AppIcon" 
                    Advertise="no" />

          <!-- Shortcut on Desktop -->
          <Shortcut Id="desktopShortcut"
                    Directory="DesktopFolder"
                    Name="CompactApp"
                    Description="Launch CompactApp"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="AppIcon"
                    Advertise="no" />
        </File>

        <!-- Write uninstall registry key (helps ARP and for custom logic) -->
        <RegistryValue Root="HKLM" Key="Software\YourCompany\CompactApp" Name="Installed" Type="integer" Value="1" KeyPath="no" />

        <!-- Remove the desktop shortcut on uninstall if present -->
        <RemoveFile Id="RemoveDesktopShortcut" Name="CompactApp.lnk" On="uninstall" Directory="DesktopFolder" />
      </Component>
    </DirectoryRef>

    <!-- Shortcuts require a separate component for the start menu folder (best practice) -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="cmpStartMenuFolder" Guid="*">
        <CreateFolder />
        <RemoveFolder Id="RemoveProgramMenuFolder" On="uninstall" Directory="ApplicationProgramsFolder" />
        <RegistryValue Root="HKLM" Key="Software\YourCompany\CompactApp" Name="InstalledStartMenu" Type="integer" Value="1" KeyPath="no" />
      </Component>
    </DirectoryRef>

    <!-- Feature wiring -->
    <Feature Id="ProductFeature" Title="CompactApp" Level="1">
      <ComponentRef Id="cmpMainExe" />
      <ComponentRef Id="cmpStartMenuFolder" />
    </Feature>

    <!-- Icon and ARP product icon -->
    <!-- Use the EXE as the SourceFile to extract the icon; if you have a separate .ico file, point to that instead -->
    <Icon Id="AppIcon" SourceFile="$(var.CompactAppWinForms.TargetPath)" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />

    <!-- Standard install UI with install-folder dialog -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Optional: register a file association or other registry entries here -->
  </Product>
</Wix>
